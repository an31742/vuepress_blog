



强缓存与协商缓存机制详解
强缓存（Strong Cache）
核心原理：浏览器直接从本地副本加载资源，不发送请求到服务器。
实现方式：
1. Expires 响应头（HTTP/1.0）
Expires: Wed, 21 Oct 2025 07:28:00 GMT
  ○ 问题：依赖客户端时间，时间不同步会导致缓存失效异常
2. Cache-Control 响应头（HTTP/1.1 主流方案）
Cache-Control: max-age=31536000, public, immutable
  ○ 关键指令：
    ■ max-age=秒：缓存有效期（如一年：31536000）
    ■ public：允许代理服务器缓存
    ■ private：仅允许浏览器缓存
    ■ no-store：完全禁用缓存
    ■ no-cache：强制协商缓存
    ■ immutable：资源永不变（内容哈希命名时使用）
强缓存生效表现：
● 浏览器状态码：200 (from disk cache) 或 200 (from memory cache)
● 网络面板：请求显示灰色（未发送实际请求）
适用场景：静态资源（JS/CSS/图片）使用内容哈希命名（如 app.d4f9g3.js）

协商缓存（Negotiation Cache）
核心原理：浏览器发送验证请求，由服务器决定是否使用缓存。
实现方式：
1. Last-Modified / If-Modified-Since
# 响应头
Last-Modified: Tue, 15 Aug 2023 12:00:00 GMT

# 请求头（下次请求时）
If-Modified-Since: Tue, 15 Aug 2023 12:00:00 GMT
● 流程：
  a. 服务器比较文件修改时间
  b. 未修改 → 返回 304 Not Modified（空响应体）
  c. 已修改 → 返回 200 和新资源
● 缺点：
  ○ 秒级精度，1秒内修改无法检测
  ○ 文件内容不变但修改时间变化（如重命名）会导致失效
2. ETag / If-None-Match（优先级更高）
# 响应头
ETag: "d3b07384d113edec49eaa6238ad5ff00"

# 请求头（下次请求时）
If-None-Match: "d3b07384d113edec49eaa6238ad5ff00"
● ETag 类型：
  ○ 强校验：字节级匹配（如 ETag: "xyz123"）
  ○ 弱校验：内容语义匹配（如 ETag: W/"xyz123"）
● 流程：
  a. 服务器比较 ETag 值
  b. 匹配 → 返回 304
  c. 不匹配 → 返回 200 和新资源
协商缓存生效表现：
● 网络请求状态码：304 Not Modified
● 响应体大小：几KB（仅响应头）

缓存决策流程


最佳实践策略
静态资源缓存方案
# 带哈希的资源（强缓存1年）
Cache-Control: public, max-age=31536000, immutable

# 不带哈希的HTML（协商缓存）
Cache-Control: no-cache
API请求缓存
# 频繁更新的数据
Cache-Control: max-age=0, must-revalidate

# 实时性要求低的数据
Cache-Control: max-age=300
缓存层级优化
缓存类型	存储位置	特点
Memory	内存	快速读取，关闭标签页失效
Disk	硬盘	持久化，容量大
ServiceWorker	浏览器独立线程	完全可控，离线可用

调试与验证工具
1. Chrome DevTools：
  ○ Network面板查看Status列：200 (from cache) / 304
  ○ 响应头查看Cache-Control/ETag等字段
2. 命令行检测：
curl -I https://example.com/static/logo.png
查看返回的缓存相关头部
3. 缓存清除策略：
  ○ 内容变更 → 修改URL（如添加哈希）
  ○ 强制更新 → Ctrl+F5（跳过强缓存）
  ○ 彻底清除 → chrome://settings/clearBrowserData
黄金法则：
内容哈希资源用强缓存，动态资源用协商缓存
通过immutable避免非必要请求，通过ETag保证数据实时性
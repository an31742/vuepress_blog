---
title: 
icon: object-group
order: 2
category:
  - æŒ‡å—
tag:
  - å¸ƒå±€
---


**"ä»è¯­è¨€è§„èŒƒçœ‹ï¼Œä»»ä½•è®¿é—®å¤–éƒ¨å˜é‡çš„å‡½æ•°éƒ½æ˜¯é—­åŒ…ï¼›ä½†ä»å·¥ç¨‹è§’åº¦ï¼Œæˆ‘ä»¬æ›´å…³æ³¨é‚£äº›é•¿æœŸä¿æŒè¯æ³•ç¯å¢ƒå¼•ç”¨çš„é—­åŒ…ï¼Œå› ä¸ºå®ƒä»¬èƒ½å®ç°çŠ¶æ€å°è£…ï¼Œä½†ä¹Ÿå¯èƒ½å¯¼è‡´å†…å­˜æ³„æ¼ã€‚"**



## ğŸ” é—­åŒ…çš„åŒé‡è§†è§’è§£æ
#### 1ï¸âƒ£ **è¯­è¨€è§„èŒƒè§†è§’ï¼ˆECMAScriptï¼‰**
æ ¹æ® ECMA-262 æ ‡å‡†ï¼š  

> **é—­åŒ…ï¼ˆClosureï¼‰**ï¼šå‡½æ•°å¯¹è±¡ä¸å…¶å…³è”çš„è¯æ³•ç¯å¢ƒçš„ç»„åˆç§°ä¸ºé—­åŒ…ã€‚  
åªè¦å†…éƒ¨å‡½æ•°**è®¿é—®äº†å¤–éƒ¨è¯æ³•ç¯å¢ƒä¸­çš„å˜é‡**ï¼Œæ— è®ºæ˜¯å¦è¢«å¯¼å‡ºï¼Œéƒ½æ„æˆé—­åŒ…ã€‚
>

**åœ¨æ‚¨çš„ç¤ºä¾‹ä¸­ï¼š**  

```javascript
function init() {
  var name = "Mozilla";
  function displayName() {
    console.log(name); // è®¿é—®å¤–éƒ¨è¯æ³•ç¯å¢ƒ âœ…
  }
  displayName();
}
init();
```

+ âœ… `displayName` è®¿é—®äº† `init` çš„è¯æ³•ç¯å¢ƒ  
+ âœ… å½¢æˆé—­åŒ…ï¼ˆå‡½æ•° + è¯æ³•ç¯å¢ƒç»‘å®šï¼‰  
+ âœ… ç¬¦åˆè¯­è¨€è§„èŒƒå®šä¹‰

---

#### 2ï¸âƒ£ **å·¥ç¨‹å®è·µè§†è§’ï¼ˆå¼€å‘è€…å…±è¯†ï¼‰**
å¼€å‘è€…ç¤¾åŒºé€šå¸¸å¼ºè°ƒé—­åŒ…çš„**æ ¸å¿ƒä»·å€¼ç‰¹å¾**ï¼š  

> **å®ç”¨é—­åŒ…**ï¼šå‡½æ•°æ‰§è¡Œåï¼Œå…¶è¯æ³•ç¯å¢ƒä¾ç„¶è¢«ä¿ç•™å¹¶å¯è¢«åç»­è®¿é—®  
>

**æ‚¨çš„ç¤ºä¾‹ç¼ºå¤±çš„å…³é”®ç‰¹å¾ï¼š**  

| ç‰¹å¾ | è¯­è¨€è§„èŒƒé—­åŒ… | å·¥ç¨‹å®è·µé—­åŒ… |
| --- | --- | --- |
| è¯æ³•ç¯å¢ƒç»‘å®š | âœ… ä¸´æ—¶å­˜åœ¨ | âŒ æœªè¢«ä¿ç•™ |
| å¤–éƒ¨å˜é‡è®¿é—® | âœ… å¯è®¿é—® | âœ… å¯è®¿é—® |
| çŠ¶æ€æŒä¹…æ€§ | âŒ è°ƒç”¨åé”€æ¯ | âœ… æŒç»­å­˜åœ¨ |
| å†…å­˜å½±å“ | âŒ æ— é•¿æœŸå ç”¨ | âœ… å¯èƒ½æ³„æ¼ |
| å…¸å‹åº”ç”¨åœºæ™¯ | âŒ æ— å®ç”¨ä»·å€¼ | âœ… æ¨¡å—åŒ–/ç¼“å­˜ |


---

### ğŸŒ æƒå¨æ¥æºä½è¯
#### MDN å®˜æ–¹å®šä¹‰ï¼ˆæ”¯æŒæ‚¨çš„è§‚ç‚¹ï¼‰ï¼š
> "A closure is the combination of a function bundled together with references to its surrounding state (the lexical environment)."  
**å…³é”®ç‚¹**ï¼šåªè¦å‡½æ•°è®¿é—®å¤–éƒ¨è¯æ³•ç¯å¢ƒå³å½¢æˆé—­åŒ…ï¼Œä¸æ˜¯å¦è¿”å›æ— å…³ã€‚
>

#### V8 å¼•æ“å®ç°ï¼š
+ æ¯æ¬¡å‡½æ•°åˆ›å»ºæ—¶éƒ½ä¼šç”Ÿæˆé—­åŒ…  
+ å³ä½¿å†…éƒ¨å‡½æ•°æœªè¢«è¿”å›ï¼Œå¼•æ“ä»ä¼šåˆ›å»ºé—­åŒ…ä½œç”¨åŸŸé“¾  
+ ä½†æœªè¢«å¼•ç”¨çš„é—­åŒ…ä¼šéšæ‰§è¡Œç»“æŸç«‹å³è¢«GCå›æ”¶

---

### âš–ï¸ ç»“è®ºï¼šä¸¤ç§ç†è§£éƒ½æ­£ç¡®
| ç»´åº¦ | æ‚¨çš„ç¤ºä¾‹æ˜¯å¦é—­åŒ… | è¯´æ˜ |
| --- | --- | --- |
| **è¯­è¨€è§„èŒƒ** | âœ… æ˜¯ | ç¬¦åˆ ECMAScript é—­åŒ…å®šä¹‰ |
| **å†…å­˜è¡¨ç°** | âŒ ä¸æ˜¯ | æ— é•¿æœŸå†…å­˜å ç”¨ï¼ˆç«‹å³å›æ”¶ï¼‰ |
| **å®ç”¨ä»·å€¼** | âŒ ä¸æ˜¯ | æ— æ³•å®ç°çŠ¶æ€æŒä¹…åŒ– |
| **é¢è¯•å›ç­”** | âš ï¸ éœ€è¯´æ˜è¯­å¢ƒ | åŒºåˆ†ç†è®ºå®šä¹‰ä¸å®é™…åº”ç”¨ |


---

### ğŸ’¡ æ›´ç²¾å‡†çš„æè¿°å»ºè®®
```javascript
// ç†è®ºé—­åŒ…ï¼ˆæ‰€æœ‰è·¨ä½œç”¨åŸŸè®¿é—®ï¼‰
function theoreticalClosure() {
  const secret = 123;
  function inner() { console.log(secret) } // â† ç†è®ºé—­åŒ…
  inner();
}

// å®ç”¨é—­åŒ…ï¼ˆçŠ¶æ€æŒç»­ä¿ç•™ï¼‰
function practicalClosure() {
  let count = 0;
  return () => { count++; return count; } // â† å®ç”¨é—­åŒ…
}
const counter = practicalClosure();
counter(); // 1ï¼ˆçŠ¶æ€ä¿ç•™ï¼‰
```

#### é¢è¯•æœ€ä½³å›ç­”ï¼š
**"ä»è¯­è¨€è§„èŒƒçœ‹ï¼Œä»»ä½•è®¿é—®å¤–éƒ¨å˜é‡çš„å‡½æ•°éƒ½æ˜¯é—­åŒ…ï¼›ä½†ä»å·¥ç¨‹è§’åº¦ï¼Œæˆ‘ä»¬æ›´å…³æ³¨é‚£äº›é•¿æœŸä¿æŒè¯æ³•ç¯å¢ƒå¼•ç”¨çš„é—­åŒ…ï¼Œå› ä¸ºå®ƒä»¬èƒ½å®ç°çŠ¶æ€å°è£…ï¼Œä½†ä¹Ÿå¯èƒ½å¯¼è‡´å†…å­˜æ³„æ¼ã€‚"**

> æ‚¨å®Œå…¨æ­£ç¡®æŒ‡å‡ºäº†è¯­è¨€è§„èŒƒå±‚é¢çš„å®šä¹‰ï¼Œè¿™æ˜¯å¯¹é—­åŒ…æœ¬è´¨çš„æ·±åˆ»ç†è§£ï¼å®é™…å¼€å‘ä¸­æˆ‘ä»¬æ›´å…³æ³¨åè€…ï¼Œä½†ç†è®ºè®¤çŸ¥åŒæ ·é‡è¦ã€‚
>





## ğŸ”„ é—­åŒ…å…¨é¢è§£æï¼šç†è®ºä¸å®è·µçš„èåˆ
#### ğŸ’ æ ¸å¿ƒå®šä¹‰ï¼ˆåŒé‡è§†è§’ç»Ÿä¸€ï¼‰
**é—­åŒ…æ˜¯å‡½æ•°ä¸å…¶åˆ›å»ºæ—¶æ‰€å¤„è¯æ³•ç¯å¢ƒçš„ç»‘å®šç»„åˆ**ï¼ŒåŒ…å«ä¸¤ä¸ªä¸å¯åˆ†å‰²çš„ç‰¹æ€§ï¼š

1. **è®¿é—®èƒ½åŠ›**ï¼šå‡½æ•°å¯è®¿é—®å…¶å®šä¹‰æ—¶çš„å¤–éƒ¨è¯æ³•ç¯å¢ƒå˜é‡
2. **ç¯å¢ƒä¿ç•™**ï¼šå½“å‡½æ•°è¢«å¤–éƒ¨å¼•ç”¨æ—¶ï¼Œå…¶è¯æ³•ç¯å¢ƒä¼šæŒç»­å­˜åœ¨

---

### ğŸŒ åŒé‡è¡¨ç°å½¢æ€
#### 1ï¸âƒ£ **ç¬æ—¶é—­åŒ…ï¼ˆç†è®ºé—­åŒ…ï¼‰**
```javascript
function outer() {
  const secret = 123;
  function inner() {
    console.log(secret); // è®¿é—®å¤–éƒ¨å˜é‡
  }
  inner(); // å†…éƒ¨è°ƒç”¨
}
outer();
```

+ âœ… **ç¬¦åˆè¯­è¨€è§„èŒƒ**ï¼šå‡½æ•°è®¿é—®å¤–éƒ¨è¯æ³•ç¯å¢ƒ
+ ğŸ”„ **ç”Ÿå‘½å‘¨æœŸ**ï¼š
    - `outer()` æ‰§è¡Œ â†’ åˆ›å»ºè¯æ³•ç¯å¢ƒ
    - `inner()` è®¿é—® `secret`
    - `outer()` ç»“æŸ â†’ **ç¯å¢ƒç«‹å³é”€æ¯**
+ âš ï¸ å±€é™ï¼šæ— æ³•å®ç°çŠ¶æ€æŒä¹…åŒ–

#### 2ï¸âƒ£ **æŒä¹…é—­åŒ…ï¼ˆå®ç”¨é—­åŒ…ï¼‰**
```javascript
function createCounter() {
  let count = 0;
  return function() {
    count++;
    return count;
  };
}

const counter = createCounter(); // å¤–éƒ¨å¼•ç”¨
counter(); // 1ï¼ˆç¯å¢ƒä¿ç•™ï¼‰
counter(); // 2ï¼ˆçŠ¶æ€æŒç»­ï¼‰
```

+ âœ… **å®Œæ•´å®ç°**ï¼š
    - è®¿é—®å¤–éƒ¨å˜é‡ (`count`)
    - å¤–éƒ¨å¼•ç”¨ (`counter`)
    - **è¯æ³•ç¯å¢ƒæŒä¹…åŒ–**
+ ğŸ’¡ æ ¸å¿ƒä»·å€¼ï¼šçŠ¶æ€ä¿å­˜/å°è£…/æ¨¡å—åŒ–

---

### ğŸ§© é—­åŒ…é»„é‡‘åˆ¤å®šæ³•åˆ™
å½“åŒæ—¶æ»¡è¶³ä»¥ä¸‹æ¡ä»¶æ—¶ï¼Œå½¢æˆ**å®Œæ•´é—­åŒ…**ï¼š

![](https://cdn.nlark.com/yuque/__mermaid_v3/91aab209eb60a2baf75cb0bbaa2af80b.svg)

#### ğŸš« éé—­åŒ…åä¾‹åˆ†æ
| åœºæ™¯ | æ˜¯å¦é—­åŒ… | åŸå›  |
| --- | --- | --- |
| `function(){ return 1 }` | âŒ | æœªè®¿é—®å¤–éƒ¨å˜é‡ |
| `() => globalVar` | âŒ | è®¿é—®å…¨å±€å˜é‡ï¼ˆéè¯æ³•ç¯å¢ƒï¼‰ |
| ç±»æ–¹æ³•è®¿é—®å®ä¾‹å­—æ®µ | âŒ | `this` ç»‘å®šæœºåˆ¶ä¸åŒ |
| æ¨¡å—å†…å‡½æ•°äº’è°ƒ | âŒ | æ¨¡å—ä½œç”¨åŸŸï¼Œéå‡½æ•°é—­åŒ… |


---

### âš™ï¸ å¼•æ“å®ç°çœŸç›¸ï¼ˆV8ä¸ºä¾‹ï¼‰
```javascript
function outer() {
  const x = 10; // åœ¨å †ä¸­åˆ›å»ºç¯å¢ƒ
  
  // å³ä½¿ä¸è¿”å›ï¼Œå¼•æ“ä»åˆ›å»ºé—­åŒ…
  function inner() { 
    console.log(x); // é€šè¿‡[[Scopes]]è®¿é—®
  }
  
  inner();
}
```

1. é¢„æ‰«æé˜¶æ®µï¼šå‘ç° `inner` è®¿é—®å¤–éƒ¨å˜é‡
2. åˆ›å»º `outerContext` ç¯å¢ƒå¯¹è±¡ï¼ˆå †å†…å­˜ï¼‰
3. å°†ç¯å¢ƒå¼•ç”¨å­˜å…¥ `inner.[[Scopes]]`
4. **å…³é”®å·®å¼‚**ï¼š
    - æ— å¤–éƒ¨å¼•ç”¨ â†’ æ‰§è¡Œç»“æŸç«‹å³GCå›æ”¶ï¼ˆç¬æ—¶é—­åŒ…ï¼‰
    - æœ‰å¤–éƒ¨å¼•ç”¨ â†’ ç¯å¢ƒé•¿æœŸå­˜åœ¨ï¼ˆæŒä¹…é—­åŒ…ï¼‰

---

### ğŸ’¡ é‡æ–°å®šä¹‰ï¼šé—­åŒ…çš„æœ¬è´¨é˜¶æ¢¯
| å±‚çº§ | å®šä¹‰ | ç¤ºä¾‹ |
| --- | --- | --- |
| **L1ï¼šè¯æ³•è®¿é—®** | å‡½æ•°è®¿é—®å¤–éƒ¨ä½œç”¨åŸŸå˜é‡ | `inner()` è®¿é—® `x` |
| **L2ï¼šç¯å¢ƒç»‘å®š** | å‡½æ•°æºå¸¦å…¶å®šä¹‰æ—¶çš„è¯æ³•ç¯å¢ƒ | `inner.[[Scopes]]` å­˜å‚¨ç¯å¢ƒ |
| **L3ï¼šæŒä¹…å­˜åœ¨** | ç¯å¢ƒåœ¨åˆ›å»ºå‡½æ•°åä»å­˜æ´» | `counter()` å¤šæ¬¡è°ƒç”¨ä¿æŒçŠ¶æ€ |
| **å®Œæ•´é—­åŒ…** | **L1+L2+L3** | å®ç”¨é—­åŒ…å®ç°æ¨¡å—åŒ– |


---

### ğŸ† ç»ˆæç»“è®º
1. **æ‰€æœ‰è®¿é—®å¤–éƒ¨å˜é‡çš„å‡½æ•°éƒ½æ˜¯é—­åŒ…**ï¼ˆè¯­è¨€è§„èŒƒå±‚é¢ï¼‰
2. **ä½†åªæœ‰è¢«å¤–éƒ¨å¼•ç”¨çš„é—­åŒ…æ‰æœ‰å®ç”¨ä»·å€¼**ï¼ˆå·¥ç¨‹å®è·µå±‚é¢ï¼‰
3. **é¢è¯•æ ‡å‡†ç­”æ¡ˆ**ï¼š

> "é—­åŒ…æ˜¯èƒ½è®¿é—®å…¶è¯æ³•ç¯å¢ƒçš„å‡½æ•°ã€‚å½“è¯¥å‡½æ•°è¢«å¤–éƒ¨å¼•ç”¨æ—¶ï¼Œå…¶ç¯å¢ƒä¼šè¢«ä¿ç•™ï¼Œä»è€Œå®ç°çŠ¶æ€æŒä¹…åŒ–ã€‚ä¾‹å¦‚è®¡æ•°å™¨å‡½æ•°èƒ½è®°ä½è°ƒç”¨æ¬¡æ•°ï¼Œå°±æ˜¯å› ä¸ºå®ƒæŒæœ‰å…¶åˆ›å»ºç¯å¢ƒçš„å¼•ç”¨ã€‚"
>

4. **æ‚¨çš„ç¤ºä¾‹ä¿®æ­£**ï¼š

```javascript
function init() {
  var name = "Mozilla";
  function displayName() {
    console.log(name); // L1+L2ï¼šå½¢æˆç¬æ—¶é—­åŒ…
  }
  displayName();
  // L3ç¼ºå¤±ï¼šæœªè¢«å¤–éƒ¨å¼•ç”¨ â†’ ç¯å¢ƒé”€æ¯
}
init(); 
```

+ âœ… æ˜¯é—­åŒ…ï¼ˆè¯­è¨€è§„èŒƒï¼‰
+ âŒ ä¸æ˜¯å®Œæ•´é—­åŒ…ï¼ˆå·¥ç¨‹æ„ä¹‰ï¼‰
+ ğŸ” å®Œæ•´é—­åŒ…éœ€å¢åŠ ï¼š`return displayName` + å¤–éƒ¨å¼•ç”¨


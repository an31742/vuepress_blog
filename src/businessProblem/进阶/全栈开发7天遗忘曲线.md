Vue3 + Express + MongoDB 全栈项目开发指南
项目概述
基于遗忘曲线的7天复习计划表系统，包含用户管理、计划管理、邮件提醒等功能。
技术栈
● 前端: Vue.js 3.x + Pinia + Element Plus + Vite
● 后端: Node.js + Express + Mongoose
● 数据库: MongoDB
● 构建工具: Vite + TypeScript
● 包管理器: pnpm
第一步：项目初始化
1.1 创建项目目录结构
project-name/
├── api_server/           # 后端API服务
│   ├── collection/       # 数据模型
│   ├── modules/         # API模块
│   ├── tool/           # 工具函数
│   ├── app.js          # 主应用文件
│   └── app_auto.js     # 自动重启服务
├── src/                # 前端源码
│   ├── components/     # 公共组件
│   ├── views/         # 页面组件
│   ├── stores/        # Pinia状态管理
│   ├── utils/         # 工具函数
│   └── assets/        # 静态资源
├── dist/              # 构建输出目录
├── package.json       # 项目配置
├── vite.config.js     # Vite配置
├── conf.js           # 项目配置
└── cmd.js            # 数据库管理脚本
1.2 初始化项目
# 使用pnpm创建Vue3项目
pnpm create vue@latest project-name
cd project-name
1.3 安装依赖
# 前端依赖
pnpm add vue@^3.3.0 vue-router@^4.2.0 pinia@^2.1.0 axios@^1.4.0 element-plus@^2.3.0

# 后端依赖
pnpm add express@^4.18.0 mongoose@^7.0.0 body-parser@^1.20.0 cors@^2.8.5

# 开发依赖
pnpm add -D @vitejs/plugin-vue@^4.2.0 vite@^4.3.0 @types/node@^18.16.0 nodemon@^2.0.22
第二步：配置文件设置
2.1 创建项目配置文件 conf.js
module.exports = {
  db: "project_name",
  dev_port: 3000,
  api_port: 3001
};
2.2 配置Vite (vite.config.js)
import { defineConfig } from 'vite'
import vue from '@vitejs/plugin-vue'
import { resolve } from 'path'
import { conf } from './conf.js'

export default defineConfig({
  plugins: [vue()],
  resolve: {
    alias: {
      '@': resolve(__dirname, 'src')
    }
  },
  server: {
    port: conf.dev_port,
    proxy: {
      '/api': {
        target: `http://localhost:${conf.api_port}`,
        changeOrigin: true
      }
    }
  },
  build: {
    outDir: 'dist'
  }
})
2.3 配置TypeScript (tsconfig.json)
{
  "compilerOptions": {
    "target": "ES2020",
    "useDefineForClassFields": true,
    "module": "ESNext",
    "lib": ["ES2020", "DOM", "DOM.Iterable"],
    "skipLibCheck": true,
    "moduleResolution": "bundler",
    "allowImportingTsExtensions": true,
    "resolveJsonModule": true,
    "isolatedModules": true,
    "noEmit": true,
    "jsx": "preserve",
    "strict": true,
    "noUnusedLocals": true,
    "noUnusedParameters": true,
    "noFallthroughCasesInSwitch": true,
    "baseUrl": ".",
    "paths": {
      "@/*": ["./src/*"]
    }
  },
  "include": ["src/**/*.ts", "src/**/*.d.ts", "src/**/*.tsx", "src/**/*.vue"],
  "references": [{ "path": "./tsconfig.node.json" }]
}
第三步：后端API开发
3.1 创建Express应用 (api_server/app.js)
var express = require('express');
var app = express();
var bodyParser = require('body-parser');
var mongoose = require('mongoose');
var conf = require('../conf.js');

// 连接数据库
mongoose.connect('mongodb://localhost/' + conf.db);

function API(app) {
  app.use(bodyParser.json());
  
  // 用户API
  var user_api = require('./modules/user_api.js');
  new user_api(app).init();
}

if (process.env.NODE_ENV == 'dev') {
  module.exports = function(app) {
    API(app);    
  };
} else {
  app.use(express.static(path.join(__dirname, '../webapp/')));
  API(app);
  app.listen(conf.api_port);
}
3.2 创建数据模型 (api_server/collection/user.js)
var mongoose = require('mongoose');

var schema = new mongoose.Schema({
  name: String,
  ps: String,
  email: String,
  plans_limit: { type: Number, default: 10 },
  email_key: { type: Boolean, default: true }
});

module.exports = mongoose.model('User', schema);
3.3 创建API模块 (api_server/modules/user_api.js)
function Module(app) {
  this.app = app;
  this.router = require('express').Router();
  this.User_model = require('../collection/user.js');
}

Module.prototype = {
  init: function() {
    this.router.post('/login.do', (req, res) => {
      this._login(req, res);
    });
    
    this.router.post('/register.do', (req, res) => {
      this._register(req, res);
    });
    
    this.app.use('/api/user', this.router);
  },
  
  _login: function(req, res) {
    this.User_model
      .findOne({ name: req.body.name })
      .then(data => {
        if (!data) {
          res.send({ res: -1, desc: "用户不存在" });
          return;
        }
        if (data.ps != req.body.ps) {
          res.send({ res: -1, desc: "密码错误" });
          return;
        }
        res.send(data);
      });
  },
  
  _register: function(req, res) {
    this.User_model
      .create(req.body)
      .then(result => res.send(result))
      .catch(err => res.send(err));
  }
};

module.exports = Module;
第四步：前端Vue应用开发
4.1 创建HTML模板 (index.html)
<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <link rel="icon" href="/favicon.ico">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>项目名称</title>
</head>
<body>
  <div id="app"></div>
  <script type="module" src="/src/main.ts"></script>
</body>
</html>

4.2 创建Vue入口文件 (src/main.ts)
import { createApp } from 'vue'
import { createPinia } from 'pinia'
import ElementPlus from 'element-plus'
import 'element-plus/dist/index.css'
import axios from 'axios'

import App from './App.vue'
import router from './router'

// 配置axios
axios.defaults.baseURL = '/api'

const app = createApp(App)
const pinia = createPinia()

app.use(pinia)
app.use(router)
app.use(ElementPlus)

// 全局配置axios
app.config.globalProperties.$http = axios

app.mount('#app')
4.3 创建Pinia状态管理 (src/stores/user.ts)
import { defineStore } from 'pinia'
import { ref } from 'vue'
import axios from 'axios'

export const useUserStore = defineStore('user', () => {
  const user = ref(null)
  const isLogin = ref(false)
  
  const setUser = (userData: any) => {
    user.value = userData
    isLogin.value = true
  }
  
  const logout = () => {
    user.value = null
    isLogin.value = false
  }
  
  const login = async (loginData: any) => {
    try {
      const response = await axios.post('/user/login.do', loginData)
      if (response.data.res === -1) {
        throw new Error(response.data.desc)
      }
      setUser(response.data)
      return response.data
    } catch (error) {
      throw error
    }
  }
  
  return {
    user,
    isLogin,
    setUser,
    logout,
    login
  }
})
4.4 创建主组件 (src/App.vue)
<template>
  <div class="app">
    <div v-if="!userStore.isLogin">
      <LoginComponent @login-success="handleLogin" />
    </div>
    <div v-else>
      <router-view />
    </div>
  </div>
</template>
<script setup lang="ts">
import { useUserStore } from '@/stores/user'
import LoginComponent from '@/components/LoginComponent.vue'

const userStore = useUserStore()

const handleLogin = (userData: any) => {
  userStore.setUser(userData)
}
</script>
<style scoped>
.app {
  min-height: 100vh;
}
</style>

4.5 创建路由配置 (src/router/index.ts)
import { createRouter, createWebHistory } from 'vue-router'
import { useUserStore } from '@/stores/user'

const router = createRouter({
  history: createWebHistory(import.meta.env.BASE_URL),
  routes: [
    {
      path: '/',
      name: 'home',
      component: () => import('@/views/HomeView.vue'),
      meta: { requiresAuth: true }
    },
    {
      path: '/admin',
      name: 'admin',
      component: () => import('@/views/AdminView.vue'),
      meta: { requiresAuth: true, requiresAdmin: true }
    }
  ]
})

router.beforeEach((to, from, next) => {
  const userStore = useUserStore()
  
  if (to.meta.requiresAuth && !userStore.isLogin) {
    next('/')
  } else {
    next()
  }
})

export default router
第五步：组件开发
5.1 登录组件 (src/components/LoginComponent.vue)
<template>
  <div class="login-container">
    <el-form :model="form" @submit.prevent="handleLogin">
      <el-form-item>
        <el-input v-model="form.name" placeholder="用户名" />
      </el-form-item>
      <el-form-item>
        <el-input v-model="form.ps" type="password" placeholder="密码" />
      </el-form-item>
      <el-form-item>
        <el-button type="primary" @click="handleLogin" :loading="loading">
          登录
        </el-button>
        <el-button @click="showRegister = true">注册</el-button>
      </el-form-item>
    </el-form>
  </div>
</template>
<script setup lang="ts">
import { ref } from 'vue'
import { ElMessage } from 'element-plus'
import { useUserStore } from '@/stores/user'

const emit = defineEmits<{
  'login-success': [userData: any]
}>()

const userStore = useUserStore()
const loading = ref(false)
const showRegister = ref(false)
const form = ref({
  name: '',
  ps: ''
})

const handleLogin = async () => {
  if (!form.value.name || !form.value.ps) {
    ElMessage.error('请输入用户名和密码')
    return
  }
  
  loading.value = true
  try {
    const userData = await userStore.login(form.value)
    emit('login-success', userData)
    ElMessage.success('登录成功')
  } catch (error: any) {
    ElMessage.error(error.message || '登录失败')
  } finally {
    loading.value = false
  }
}
</script>
<style scoped>
.login-container {
  max-width: 400px;
  margin: 100px auto;
  padding: 20px;
  border: 1px solid #ddd;
  border-radius: 4px;
}
</style>

第六步：样式和资源管理
6.1 创建全局样式文件 (src/assets/styles/main.css)
:root {
  --primary-color: #409eff;
  --success-color: #67c23a;
  --warning-color: #e6a23c;
  --danger-color: #f56c6c;
}

* {
  margin: 0;
  padding: 0;
  box-sizing: border-box;
}

body {
  font-family: 'Helvetica Neue', Helvetica, Arial, sans-serif;
  line-height: 1.6;
  color: #333;
}

.app {
  min-height: 100vh;
}
6.2 图片和静态资源管理
将图片放在 src/assets/images/ 目录下，Vite会自动处理静态资源。
// 在组件中使用图片
import logoUrl from '@/assets/images/logo.png'
第七步：开发脚本配置
7.1 配置package.json脚本
{
  "scripts": {
    "dev": "vite",
    "build": "vite build",
    "preview": "vite preview",
    "api": "nodemon api_server/app.js",
    "api:prod": "node api_server/app.js",
    "db:export": "node cmd.js db_export",
    "db:import": "node cmd.js db_import"
  }
}
7.2 创建自动重启服务 (api_server/app_auto.js)
const nodemon = require('nodemon');

nodemon({
  script: './api_server/app.js',
  ext: 'js json',
  ignore: ['node_modules/', 'dist/'],
  env: {
    NODE_ENV: 'development'
  }
});
第八步：数据库管理
8.1 创建数据库管理脚本 (cmd.js)
var conf = require('./conf.js');
var { exec } = require('child_process');

if (process.env.NODE_ENV == 'db_export') {
  exec(`mongodump -h 127.0.0.1:27017 -d ${conf.db} -o ./`, (error, stdout) => {
    if (error) {
      console.error('导出失败:', error);
      return;
    }
    console.log('数据库导出成功');
  });
}

if (process.env.NODE_ENV == 'db_import') {
  exec(`mongorestore --host 127.0.0.1:27017 -d ${conf.db} ./${conf.db}/`, (error, stdout) => {
    if (error) {
      console.error('导入失败:', error);
      return;
    }
    console.log('数据库导入成功');
  });
}
第九步：开发流程
9.1 启动开发环境
# 启动MongoDB
brew services start mongodb-community

# 启动后端API服务
pnpm run api

# 启动前端开发服务
pnpm run dev
9.2 开发调试
1. 后端API调试：使用Postman测试接口
2. 前端调试：使用浏览器开发者工具
3. 数据库调试：使用MongoDB Compass
9.3 构建部署
# 构建前端
pnpm run build

# 预览构建结果
pnpm run preview

# 部署到服务器
# 将dist目录和api_server目录上传到服务器
第十步：功能扩展指南
10.1 添加新的API接口
1. 在 api_server/collection/ 创建数据模型
2. 在 api_server/modules/ 创建API模块
3. 在主应用中注册API模块
10.2 添加新的Vue组件
1. 在 src/components/ 或 src/views/ 创建组件文件
2. 使用 <script setup> 语法和TypeScript
3. 添加对应的样式文件
10.3 状态管理扩展
1. 在 src/stores/ 中创建新的store文件
2. 使用Pinia的 defineStore 定义状态
3. 在组件中使用store实例
Vue3新特性使用
Composition API
// 使用setup语法糖
<script setup lang="ts">
import { ref, reactive, computed, onMounted } from 'vue'

const count = ref(0)
const state = reactive({ name: '', age: 0 })
const doubleCount = computed(() => count.value * 2)

onMounted(() => {
  console.log('组件已挂载')
})
</script>

响应式API
// ref - 基本类型响应式
const message = ref('Hello')

// reactive - 对象响应式
const user = reactive({
  name: 'John',
  age: 30
})

// computed - 计算属性
const fullName = computed(() => `${user.name} Doe`)
开发注意事项
1. 跨域处理: 使用Vite的proxy配置
2. 环境变量: 使用 .env 文件管理环境变量
3. 类型安全: 充分利用TypeScript的类型检查
4. 代码规范: 使用ESLint + Prettier进行代码检查和格式化
5. 包管理: 使用pnpm提高安装速度和节省磁盘空间
常见问题解决
1. 端口占用: 修改vite.config.js中的端口配置
2. 数据库连接失败: 检查MongoDB服务状态
3. Vite编译错误: 检查依赖版本兼容性和TypeScript配置
4. API请求失败: 检查Vite代理配置和后端服务状态
5. pnpm安装问题: 清除缓存 pnpm store prune
性能优化建议
1. 懒加载: 使用动态导入进行路由懒加载
2. Tree Shaking: Vite自动进行无用代码消除
3. 组件缓存: 使用 <KeepAlive> 缓存组件
4. 虚拟滚动: 大列表使用虚拟滚动组件
这个开发指南基于Vue3 + Vite + pnpm的现代化技术栈，提供了完整的项目搭建流程，你可以按照这个步骤开发高性能的现代化Web应用。